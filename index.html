<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LOVE MOCHI AI</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{height:100vh;overflow:hidden;background:#fff;}

/* ‚ú® Sao + tim bay */
.float{position:absolute;font-size:14px;animation:fly 6s infinite ease-in-out;opacity:0.6;}
@keyframes fly{0%{transform:translateY(0)}50%{transform:translateY(-30px)}100%{transform:translateY(0)}}

/* ===== INTRO ===== */
#intro{position:fixed;inset:0;background:linear-gradient(180deg,#ffe6f1,#fff);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10;}
.logo{font-size:46px;font-weight:800;color:#ff8fb8;letter-spacing:2px;animation:pulse 1.5s infinite alternate;}
@keyframes pulse{from{transform:scale(1)}to{transform:scale(1.08)}}
.tap{margin-top:14px;color:#ff9ec6;animation:blink 1.2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.4}}

/* ===== APP ===== */
#app{position:fixed;inset:0;display:none;background:linear-gradient(180deg,#ffd1e6,#ffebf4);align-items:center;justify-content:center;animation:fade 1s ease;cursor:pointer;}
@keyframes fade{from{opacity:0}to{opacity:1}}
.phone{width:240px;height:420px;border-radius:40px;background:linear-gradient(180deg,#fff,#ffe6f1);box-shadow:0 0 35px rgba(255,120,180,0.5);display:flex;flex-direction:column;align-items:center;justify-content:center;animation:pop 1s ease;}
@keyframes pop{from{transform:scale(0)}to{transform:scale(1)}}
.heart{font-size:70px;animation:beat 1s infinite;}
@keyframes beat{0%{transform:scale(1)}50%{transform:scale(1.25)}100%{transform:scale(1)}}
.enter{margin-top:20px;color:#ff6fa7;font-size:15px;animation:blink 1.3s infinite;}

/* ===== MODAL ===== */
.modal{position:fixed;inset:0;display:none;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:20;}
.modal-content{background:#fff;color:#333;width:90%;max-width:360px;border-radius:20px;padding:20px;box-shadow:0 0 30px rgba(0,0,0,0.2);}
.modal-content h3{text-align:center;color:#ff6fa7;margin-bottom:10px;}
.modal-content button{background:#ff6fa7;color:#fff;padding:10px 18px;border-radius:18px;font-weight:600;cursor:pointer;}
.modal-content button.close{background:#aaa;margin-left:10px;}

/* ===== NHI·ªÜM V·ª§ ===== */
#task .modal-content{max-height:400px;overflow-y:auto;}
#taskStory{background:#eee;border-radius:14px;padding:12px;font-size:13px;line-height:1.5;max-height:200px;overflow-y:auto;}

/* ===== ƒêI·ªÇM DANH ===== */
#daily{position:fixed;inset:0;display:none;background:linear-gradient(180deg,#ffd1e6,#fff);align-items:center;justify-content:center;z-index:9;}
.daily-board{width:90%;max-width:360px;background:#fff;border-radius:26px;padding:22px;box-shadow:0 0 40px rgba(255,120,180,.45);}
.daily-board h2{text-align:center;color:#ff6fa7;}
.days{display:flex;gap:10px;margin:15px 0;}
.day{flex:1;padding:14px;text-align:center;background:#fff5fa;border-radius:18px;font-size:13px;}
.day.lock{opacity:.4}
.claim{background:#ff6fa7;color:#fff;padding:12px;text-align:center;border-radius:20px;font-weight:600;animation:blink 1.3s infinite;cursor:pointer;}

/* ===== CH·ªåN NH√ÇN V·∫¨T ===== */
#chars{position:fixed;inset:0;display:none;background:linear-gradient(180deg,#ffe0ef,#fff);overflow-y:auto;padding-bottom:30px;}
.char-header{text-align:center;padding:14px;font-weight:700;color:#ff6fa7;background:#fff;box-shadow:0 3px 10px rgba(255,150,190,.3);}
.flower-count{font-size:13px;margin-top:4px;}
.list{padding:14px;display:grid;grid-template-columns:repeat(2,1fr);gap:14px;}
.card{background:#fff;border-radius:18px;overflow:hidden;box-shadow:0 6px 18px rgba(255,120,180,.3);position:relative;cursor:pointer;}
.card img{width:100%;height:160px;object-fit:cover;}
.name{text-align:center;padding:8px;color:#ff6fa7;font-weight:600;}
.lock{position:absolute;inset:0;background:rgba(255,210,230,.85);display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:13px;color:#ff4f90;}
.task-btn{position:absolute;bottom:8px;right:8px;background:#ff6fa7;color:#fff;padding:6px 10px;border-radius:12px;font-size:12px;font-weight:600;cursor:pointer;}

/* ===== CHAT ===== */
#chat{position:fixed;inset:0;display:none;background:linear-gradient(180deg,#ffe6f1,#fff);flex-direction:column;}
.chat-header{padding:14px;background:#fff;box-shadow:0 3px 10px rgba(255,150,190,.3);text-align:center;font-weight:700;color:#ff6fa7;}
.chat-box{flex:1;padding:14px;overflow-y:auto;font-size:14px;color:#444;}
.msg{background:#fff;padding:10px 14px;border-radius:18px;margin-bottom:10px;width:fit-content;max-width:80%;box-shadow:0 0 12px rgba(255,150,190,.25);animation:rise .5s ease;}
.msg.char{border-top-left-radius:6px;}
.msg.user{margin-left:auto;background:#ff6fa7;color:#fff;border-top-right-radius:6px;}
.input{display:flex;padding:10px;gap:8px;}
.input input{flex:1;border:none;padding:10px;border-radius:18px;outline:none;box-shadow:0 0 8px rgba(255,150,190,.3);}
.input button{background:#ff6fa7;border:none;color:#fff;padding:0 16px;border-radius:18px;cursor:pointer;}
</style>
</head>
<body>

<script>
// ‚ú® Sao + tim bay
const icons=["‚ú®","‚≠ê","üíó","üå∏"];
for(let i=0;i<30;i++){
  let f=document.createElement("div");
  f.className="float";
  f.innerText=icons[Math.floor(Math.random()*icons.length)];
  f.style.left=Math.random()*100+"vw";
  f.style.top=Math.random()*100+"vh";
  f.style.animationDelay=Math.random()*5+"s";
  document.body.appendChild(f);
}
</script>

<!-- NH·∫¨P T√äN -->
<div id="login" class="modal" style="display:flex;">
  <div class="modal-content">
    <h3>Ch√†o m·ª´ng ƒë·∫øn Love Mochi üíó</h3>
    <input id="playerName" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." style="width:100%;padding:10px;border-radius:12px;margin-bottom:10px;outline:none;"/>
    <input id="playerAge" placeholder="Nh·∫≠p tu·ªïi..." style="width:100%;padding:10px;border-radius:12px;margin-bottom:10px;outline:none;" type="number"/>
    <div style="text-align:center;">
      <button onclick="startGame()">B·∫Øt ƒë·∫ßu</button>
    </div>
  </div>
</div>

<!-- APP -->
<div id="app">
  <div class="phone">
    <div class="heart">üíó Tr√°i tim üíó</div>
    <div class="enter">Ch·∫°m l·∫ßn n·ªØa ƒë·ªÉ ti·∫øp t·ª•c</div>
  </div>
</div>

<!-- ƒêI·ªÇM DANH -->
<div id="daily">
  <div class="daily-board">
    <h2>üå∏ ƒêi·ªÉm danh h·∫±ng ng√†y</h2>
    <div class="days">
      <div class="day lock">üîí<br>Ng√†y 1</div>
      <div class="day lock">üîí<br>Ng√†y 2</div>
      <div class="day">üå∏<br>+10 Hoa</div>
    </div>
    <div class="claim" onclick="claimFlower()">Nh·∫≠n 10 üå∏</div>
  </div>
</div>

<!-- CH·ªåN NH√ÇN V·∫¨T -->
<div id="chars">
  <div class="char-header">
    üå∏ Nh√¢n v·∫≠t LOVE MOCHI
    <div class="flower-count">Hoa hi·ªán c√≥: <span id="flower">0</span> üå∏</div>
  </div>
  <div class="list">
    <div class="card">
      <img src="https://i.imgur.com/8Qf4F6y.jpg">
      <div class="lock">üîí C·∫ßn 5 üå∏</div>
      <div class="name">Kael</div>
    </div>
    <div class="card">
      <img src="https://i.imgur.com/3sY3X5H.jpg">
      <div class="lock">üîí C·∫ßn 5 üå∏</div>
      <div class="name">Y·∫øn Tu√¢n</div>
    </div>
  </div>
</div>

<!-- CHAT -->
<div id="chat">
  <div class="chat-header" id="chatName"></div>
  <div class="chat-box" id="chatBox"></div>
  <div class="input">
    <input id="chatInput" placeholder="Nh·∫≠p tin nh·∫Øn...">
    <button onclick="sendMsg()">G·ª≠i</button>
  </div>
</div>

<!-- TASK -->
<div id="task" class="modal">
  <div class="modal-content">
    <h3 id="taskName"></h3>
    <div id="taskStory"></div>
    <div style="text-align:center;margin-top:14px;">
      <button onclick="startTask()">B·∫Øt ƒë·∫ßu nhi·ªám v·ª•</button>
      <button class="close" onclick="closeTask()">ƒê√≥ng</button>
    </div>
  </div>
</div>

<script>
// ===== Khai b√°o =====
let player = localStorage.getItem("playerName") || "";
let playerAge = localStorage.getItem("playerAge") || "";
let flowers = Number(localStorage.getItem("flowers")) || 0;
let lastClaim = localStorage.getItem("lastClaim") || "";
let unlocked = JSON.parse(localStorage.getItem("unlocked") || "[]");
let affection = JSON.parse(localStorage.getItem("affection") || "{}");
let currentTaskChar = "";

// Hi·ªÉn th·ªã hoa
document.getElementById("flower")?.innerText = flowers;

// ===== H√†m =====
function startGame(){
  const name = document.getElementById("playerName").value.trim();
  const age = document.getElementById("playerAge").value.trim();
  if(!name || !age){ alert("Nh·∫≠p ƒë·ªß t√™n v√† tu·ªïi!"); return; }

  player = name; playerAge = age;
  localStorage.setItem("playerName",player);
  localStorage.setItem("playerAge",playerAge);

  document.getElementById("login").style.display="none";
  document.getElementById("app").style.display="flex";

  // Ki·ªÉm tra ƒëi·ªÉm danh
  const today = new Date().toISOString().slice(0,10);
  if(lastClaim !== today){
    document.getElementById("daily").style.display="flex";
  } else {
    document.getElementById("chars").style.display="block";
  }
}

// ===== ƒêi·ªÉm danh =====
function claimFlower(){
  flowers +=10;
  localStorage.setItem("flowers",flowers);
  const today = new Date().toISOString().slice(0,10);
  localStorage.setItem("lastClaim",today);
  document.getElementById("flower").innerText = flowers;
  document.getElementById("daily").style.display="none";
  document.getElementById("chars").style.display="block";
}

// ===== Chat AI =====
function openChat(name){
  currentTaskChar = name;
  document.getElementById("chars").style.display="none";
  const chat = document.getElementById("chat");
  chat.style.display="flex";
  document.getElementById("chatName").innerHTML = `${name} ‚Äì Thi·ªán c·∫£m: <span id="affection">${affection[name] || 0}</span>`;

  const box = document.getElementById("chatBox");
  box.innerHTML = `<div class="msg char">Ch√†o ${player}! Anh l√† ${name} üíó</div>`;
  box.scrollTop = box.scrollHeight;
}

function sendMsg(){
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if(!text) return;
  const box = document.getElementById("chatBox");

  // Ng∆∞·ªùi ch∆°i
  const userMsg = document.createElement("div");
  userMsg.className = "msg user";
  userMsg.innerText = text;
  box.appendChild(userMsg);

  // TƒÉng thi·ªán c·∫£m
  const name = currentTaskChar;
  affection[name] = (affection[name] || 0)+1;
  localStorage.setItem("affection",JSON.stringify(affection));
  document.getElementById("affection").innerText = affection[name];

  // AI tr·∫£ l·ªùi th√¥ng minh (ƒë∆°n gi·∫£n)
  const charMsg = document.createElement("div");
  charMsg.className = "msg char";

  // M·ªôt s·ªë m·∫´u tr·∫£ l·ªùi th√¥ng minh
  const responses = [
    `Wow ${player}, anh th·∫≠t s·ª± th√≠ch c√°ch em n√≥i üòÑ`,
    `Haha, ${player} khi·∫øn anh c∆∞·ªùi qu√°!`,
    `Em nghƒ© g√¨ v·∫≠y ${player}?`,
    `Anh c·∫£m th·∫•y vui khi tr√≤ chuy·ªán v·ªõi em, ${player} üíó`,
    `Th·∫≠t tuy·ªát, ${player}! C√¢u chuy·ªán n√†y l√†m anh h·∫°nh ph√∫c`
  ];
  charMsg.innerText = responses[Math.floor(Math.random()*responses.length)];
  box.appendChild(charMsg);

  box.scrollTop = box.scrollHeight;
  input.value="";
}

// ===== Task =====
function openTask(name){
  currentTaskChar = name;
  document.getElementById("taskName").innerText = `Nhi·ªám v·ª• v·ªõi ${name}`;
  const story = {
    "Kael":"Kael t·ª´ng g·∫∑p b·∫°n ·ªü m√πa ƒë√¥ng... anh ·∫•y r·∫•t bu·ªìn. Gi√∫p Kael vui b·∫±ng tr√≤ chuy·ªán th√¢n thi·ªán!",
    "Y·∫øn Tu√¢n":"Y·∫øn Tu√¢n ƒë√£ m·∫•t m√≥n ƒë·ªì qu√Ω. Gi√∫p anh ·∫•y t√¨m l·∫°i qua tr√≤ chuy·ªán th√¥ng minh."
  };
  document.getElementById("taskStory").innerText = story[name]||"H√£y tr√≤ chuy·ªán v√† l√†m char vui!";
  document.getElementById("task").style.display="flex";
}
function closeTask(){ document.getElementById("task").style.display="none"; }
function startTask(){
  closeTask();
  openChat(currentTaskChar);
  const box = document.getElementById("chatBox");
  const msg = document.createElement("div");
  msg.className="msg char";
  msg.innerText="üéØ Nhi·ªám v·ª•: H√£y nh·∫Øn tin th·∫≠t vui v·∫ª ƒë·ªÉ tƒÉng thi·ªán c·∫£m!";
  box.appendChild(msg);
  box.scrollTop = box.scrollHeight;
}

// ===== Card =====
document.querySelectorAll(".card").forEach(card=>{
  const lock = card.querySelector(".lock");
  const name = card.querySelector(".name").innerText;

  if(unlocked.includes(name)) lock.style.display="none";

  // N√∫t nhi·ªám v·ª•
  const btn = document.createElement("div");
  btn.className="task-btn"; btn.innerText="üìú Nhi·ªám v·ª•";
  card.appendChild(btn);
  btn.onclick = e=>{ e.stopPropagation(); openTask(name); }

  // Click unlock + chat
  card.onclick = ()=>{
    if(unlocked.includes(name)){ openChat(name); return; }
    if(flowers>=5){
      if(confirm(`M·ªü kh√≥a ${name} v·ªõi 5 üå∏?`)){
        flowers-=5; localStorage.setItem("flowers",flowers);
        document.getElementById("flower").innerText=flowers;
        unlocked.push(name); localStorage.setItem("unlocked",JSON.stringify(unlocked));
        if(!(name in affection)) affection[name]=0; localStorage.setItem("affection",JSON.stringify(affection));
        lock.style.display="none"; openChat(name);
      }
    } else alert("Ch∆∞a ƒë·ªß 5 üå∏!");
  }
});
</script>
</body>
      </html>

<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Love Mochi AI</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{height:100vh;overflow:hidden;background:#fff;}

/* --- Intro --- */
#intro{position:fixed;inset:0;background:linear-gradient(180deg,#ffcee5,#fff);display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:999;overflow:hidden;}
#introContent h1{font-size:36px;color:#ff6fa7;margin-bottom:10px;animation:zoom 1.5s ease-out;}
#introContent p{font-size:18px;color:#ff4f90;margin-bottom:20px;animation:fadeIn 2s ease-out;}
#introContent button{padding:12px 24px;border:none;border-radius:20px;background:#ff6fa7;color:#fff;font-weight:700;cursor:pointer;animation:fadeIn 2.5s ease-out;}
@keyframes zoom{0%{transform:scale(0)}100%{transform:scale(1)}}
@keyframes fadeIn{0%{opacity:0}100%{opacity:1}}
.floatIntro{position:absolute;font-size:20px;animation:fly 6s infinite ease-in-out;opacity:0.6;}
@keyframes fly{0%{transform:translateY(0)}50%{transform:translateY(-30px)}100%{transform:translateY(0)}}

/* --- Modal c∆° b·∫£n --- */
.modal{position:fixed;inset:0;display:none;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:50;}
.modal-content{background:#fff;color:#333;width:90%;max-width:400px;border-radius:20px;padding:20px;box-shadow:0 0 30px rgba(0,0,0,0.2);}
.modal-content h3{text-align:center;color:#ff6fa7;margin-bottom:10px;}
.modal-content button{background:#ff6fa7;color:#fff;padding:10px 18px;border-radius:18px;font-weight:600;cursor:pointer;}
.modal-content button.close{background:#aaa;margin-left:10px;}

/* --- Chat --- */
#chat{position:fixed;inset:0;display:none;background:linear-gradient(180deg,#ffe6f1,#fff);flex-direction:column;height:100%;}
.chat-header{padding:14px;background:#fff;box-shadow:0 3px 10px rgba(255,150,190,.3);text-align:center;font-weight:700;color:#ff6fa7;}
.chat-box{flex:1;padding:14px;overflow-y:auto;font-size:14px;color:#444;}
.msg{background:#fff;padding:10px 14px;border-radius:18px;margin-bottom:10px;width:fit-content;max-width:80%;box-shadow:0 0 12px rgba(255,150,190,.25);}
.msg.char{border-top-left-radius:6px;}
.msg.user{margin-left:auto;background:#ff6fa7;color:#fff;border-top-right-radius:6px;}
.input{display:flex;padding:10px;gap:8px;}
.input input{flex:1;border:none;padding:10px;border-radius:18px;outline:none;box-shadow:0 0 8px rgba(255,150,190,.3);}
.input button{background:#ff6fa7;border:none;color:#fff;padding:0 16px;border-radius:18px;cursor:pointer;}

/* --- Card char --- */
#chars{position:fixed;inset:0;display:none;background:linear-gradient(180deg,#ffe0ef,#fff);overflow-y:auto;padding-bottom:30px;}
.char-header{text-align:center;padding:14px;font-weight:700;color:#ff6fa7;background:#fff;box-shadow:0 3px 10px rgba(255,150,190,.3);}
.flower-count{font-size:13px;margin-top:4px;}
.list{padding:14px;display:grid;grid-template-columns:repeat(2,1fr);gap:14px;}
.card{background:#fff;border-radius:18px;overflow:hidden;box-shadow:0 6px 18px rgba(255,120,180,.3);position:relative;cursor:pointer;}
.card img{width:100%;height:160px;object-fit:cover;}
.name{text-align:center;padding:8px;color:#ff6fa7;font-weight:600;}
.lock{position:absolute;inset:0;background:rgba(255,210,230,.85);display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:13px;color:#ff4f90;}
.task-btn{position:absolute;bottom:8px;right:8px;background:#ff6fa7;color:#fff;padding:6px 10px;border-radius:12px;font-size:12px;font-weight:600;cursor:pointer;}
.thought-icon{position:absolute;top:6px;right:6px;font-size:18px;cursor:pointer;}

/* --- Daily --- */
#daily{position:fixed;inset:0;display:none;background:linear-gradient(180deg,#ffd1e6,#fff);align-items:center;justify-content:center;z-index:9;}
.daily-board{width:90%;max-width:360px;background:#fff;border-radius:26px;padding:22px;box-shadow:0 0 40px rgba(255,120,180,.45);}
.claim{background:#ff6fa7;color:#fff;padding:12px;text-align:center;border-radius:20px;font-weight:600;animation:blink 1.3s infinite;cursor:pointer;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.6}}

/* --- Task --- */
#task .modal-content{max-height:80vh;overflow-y:auto;}

/* --- Phone Char --- */
#phoneChar{position:fixed;inset:0;display:none;background:linear-gradient(180deg,#ffe6f1,#fff);flex-direction:column;overflow-y:auto;}
.phone-header{padding:14px;background:#fff;box-shadow:0 3px 10px rgba(255,150,190,.3);text-align:center;font-weight:700;color:#ff6fa7;}
.phone-content{padding:14px;}
.phone-section{margin-bottom:14px;}
.phone-section h4{color:#ff6fa7;margin-bottom:6px;}
.phone-section div{background:#fff;padding:8px;border-radius:12px;margin-bottom:4px;box-shadow:0 0 6px rgba(255,120,180,.2);}
</style>
</head>
<body>

<!-- === Intro Overlay === -->
<div id="intro">
  <div id="introContent">
    <h1>üíó Love Mochi AI üíó</h1>
    <p>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi th·∫ø gi·ªõi Mochi!</p>
    <button onclick="showLogin()">B·∫Øt ƒë·∫ßu</button>
  </div>
</div>

<!-- Sao + tim bay intro -->
<script>
const iconsIntro=["‚ú®","‚≠ê","üíó","üå∏"];
for(let i=0;i<30;i++){
  let f=document.createElement("div");
  f.className="floatIntro";
  f.innerText=iconsIntro[Math.floor(Math.random()*iconsIntro.length)];
  f.style.left=Math.random()*100+"vw";
  f.style.top=Math.random()*100+"vh";
  f.style.animationDelay=Math.random()*5+"s";
  document.body.appendChild(f);
}
function showLogin(){
  document.getElementById("intro").style.display="none";
  document.getElementById("login").style.display="flex";
}
</script>

<!-- === Modal Login === -->
<div id="login" class="modal">
  <div class="modal-content">
    <h3>Ch√†o m·ª´ng ƒë·∫øn Love Mochi üíó</h3>
    <input id="playerName" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." style="width:100%;padding:10px;border-radius:12px;margin-bottom:10px;outline:none;"/>
    <input id="playerAge" placeholder="Nh·∫≠p tu·ªïi..." style="width:100%;padding:10px;border-radius:12px;margin-bottom:10px;outline:none;" type="number"/>
    <div style="text-align:center;">
      <button onclick="startGame()">B·∫Øt ƒë·∫ßu</button>
    </div>
  </div>
</div>

<!-- === Char List === -->
<div id="chars">
  <div class="char-header">
    üå∏ Nh√¢n v·∫≠t LOVE MOCHI
    <div class="flower-count">Hoa: <span id="flower">0</span> üå∏</div>
  </div>
  <div class="list" id="charList"></div>
</div>

<!-- === Chat === -->
<div id="chat">
  <div class="chat-header" id="chatName"></div>
  <div class="chat-box" id="chatBox"></div>
  <div class="input">
    <input id="chatInput" placeholder="Nh·∫≠p tin nh·∫Øn...">
    <button onclick="sendMsg()">G·ª≠i</button>
  </div>
</div>

<!-- === Daily === -->
<div id="daily">
  <div class="daily-board">
    <h2>üå∏ ƒêi·ªÉm danh h·∫±ng ng√†y</h2>
    <div class="claim" onclick="claimFlower()">Nh·∫≠n 10 üå∏</div>
  </div>
</div>

<!-- === Task === -->
<div id="task" class="modal">
  <div class="modal-content">
    <h3 id="taskName"></h3>
    <div id="taskStory"></div>
    <div style="text-align:center;margin-top:14px;">
      <button onclick="startTask()">B·∫Øt ƒë·∫ßu nhi·ªám v·ª•</button>
      <button class="close" onclick="closeTask()">ƒê√≥ng</button>
    </div>
  </div>
</div>

<!-- === Phone Char (Doki Chat) === -->
<div id="phoneChar">
  <div class="phone-header" id="phoneHeader"></div>
  <div class="phone-content" id="phoneContent"></div>
</div>

<script>
// ===== Khai b√°o =====
let player="", playerAge="";
let flowers=Number(localStorage.getItem("flowers")||0);
let lastClaim=localStorage.getItem("lastClaim")||"";
let unlocked=JSON.parse(localStorage.getItem("unlocked")||"[]");
let affection=JSON.parse(localStorage.getItem("affection")||"{}");
let currentChar="";
let charData={
  "Kael":{img:"https://i.imgur.com/8Km9tLL.png",personality:"vui v·∫ª", mood:0, thoughts:["H√¥m nay tr·ªùi ƒë·∫πp qu√°!","M√¨nh mu·ªën ƒëi ch∆°i c√πng b·∫°n"], messages:[], searches:[], schedule:["08:00: Cafe","10:00: L√†m vi·ªác","18:00: ƒêi d·∫°o"]},
  "Y·∫øn Tu√¢n":{img:"https://i.imgur.com/Qt6g4Fh.png",personality:"tr·∫ßm l·∫Øng", mood:0, thoughts:["M√¨nh c·∫£m th·∫•y bu·ªìn m·ªôt ch√∫t","Mu·ªën nghe nh·∫°c nh·∫π"], messages:[], searches:[], schedule:["09:00: Th·ªÉ thao","12:00: ƒÇn tr∆∞a","20:00: Xem phim"]}
};
document.getElementById("flower").innerText=flowers;

// ===== Game Start =====
function startGame(){
  const name=document.getElementById("playerName").value.trim();
  const age=document.getElementById("playerAge").value.trim();
  if(!name||!age){alert("Nh·∫≠p ƒë·ªß t√™n v√† tu·ªïi!");return;}
  player=name; playerAge=age;
  localStorage.setItem("playerName",player);
  localStorage.setItem("playerAge",playerAge);
  document.getElementById("login").style.display="none";
  
  const today=new Date().toISOString().slice(0,10);
  if(lastClaim!==today){
    document.getElementById("daily").style.display="flex";
  }else showCharList();
}

// ===== Daily =====
function claimFlower(){
  flowers+=10;
  localStorage.setItem("flowers",flowers);
  const today=new Date().toISOString().slice(0,10);
  localStorage.setItem("lastClaim",today);
  document.getElementById("flower").innerText=flowers;
  document.getElementById("daily").style.display="none";
  showCharList();
}

// ===== Show Char List =====
function showCharList(){
  document.getElementById("chars").style.display="block";
  const list=document.getElementById("charList");
  list.innerHTML="";
  for(const name in charData){
    const c=document.createElement("div");
    c.className="card";
    
    // Hi·ªÉn th·ªã ·∫£nh n·∫øu c√≥
    if(charData[name].img)c.innerHTML=`<img src="${charData[name].img}" alt="${name}"><div class="name">${name}</div>`;
    else c.innerHTML=`<div class="name">${name}</div>`;
    
    // Thought icon
    const thought=document.createElement("div");
    thought.className="thought-icon"; 
    thought.innerText="üí≠";
    thought.onclick=e=>{
      e.stopPropagation();
      if(charData[name].thoughts.length===0){
        alert("Kh√¥ng c√≥ suy nghƒ© üò∂");
      } else alert(charData[name].thoughts.join("\n"));
    };
    c.appendChild(thought);

    // Lock n·∫øu ch∆∞a unlock
    if(!unlocked.includes(name)){
      const lock=document.createElement("div");
      lock.className="lock";
      lock.innerText="Kh√≥a üîí\nTr√≤ chuy·ªán ƒë·ªÉ m·ªü";
      c.appendChild(lock);
    }

    // Click m·ªü chat
    c.onclick=()=>{
      if(!unlocked.includes(name)){
        unlocked.push(name);
        localStorage.setItem("unlocked",JSON.stringify(unlocked));
      }
      openChat(name);
    };

    list.appendChild(c);
  }
}

// ===== Chat =====
function openChat(name){
  currentChar=name;
  document.getElementById("chars").style.display="none";
  document.getElementById("chat").style.display="flex";
  document.getElementById("chatName").innerText=`${name} ‚Äì Thi·ªán c·∫£m: ${affection[name]||0}`;
  
  const box=document.getElementById("chatBox");
  box.innerHTML=`<div class="msg char">Ch√†o ${player}! Anh l√† ${name} üíó</div>`;
  charData[currentChar].messages.push({from:"char", text:`Ch√†o ${player}! Anh l√† ${name} üíó`});
  updatePhoneChar();
}

// Fake AI tr·∫£ l·ªùi c√≥ delay
function sendMsg(){
  const input=document.getElementById("chatInput");
  const text=input.value.trim();
  if(!text) return;
  const box=document.getElementById("chatBox");

  // User msg
  const userMsg=document.createElement("div"); 
  userMsg.className="msg user"; 
  userMsg.innerText=text; 
  box.appendChild(userMsg);
  charData[currentChar].messages.push({from:"player", text});

  // Update thi·ªán c·∫£m
  affection[currentChar]=(affection[currentChar]||0)+1;
  localStorage.setItem("affection",JSON.stringify(affection));
  document.getElementById("chatName").innerText=`${currentChar} ‚Äì Thi·ªán c·∫£m: ${affection[currentChar]}`;

  input.value="";
  box.scrollTop=box.scrollHeight;

  // AI reply delay
  setTimeout(()=>{
    const reply=document.createElement("div"); 
    reply.className="msg char";
    const responses=[
      `Haha ${player}, th·∫≠t vui khi em n√≥i v·∫≠y!`,
      `${player}, anh nghƒ© em th·∫≠t ƒë√°ng y√™u üòÑ`,
      `Anh th·∫•y ${player} h√¥m nay th·∫≠t tuy·ªát v·ªùi!`,
      `√îi ${player}, chuy·ªán ƒë√≥ nghe th√∫ v·ªã qu√°!`
    ];
    reply.innerText=responses[Math.floor(Math.random()*responses.length)];
    box.appendChild(reply);
    charData[currentChar].messages.push({from:"char", text:reply.innerText});
    box.scrollTop=box.scrollHeight;
    updatePhoneChar();
  },800);
}

// ===== Task =====
function openTask(name){
  currentChar=name;
  document.getElementById("taskName").innerText=`Nhi·ªám v·ª• v·ªõi ${name}`;
  document.getElementById("taskStory").innerText=`H√£y tr√≤ chuy·ªán vui v·∫ª v·ªõi ${name} ƒë·ªÉ tƒÉng thi·ªán c·∫£m! Ho√†n th√†nh s·∫Ω nh·∫≠n 10 üå∏.`;
  document.getElementById("task").style.display="flex";
}
function closeTask(){document.getElementById("task").style.display="none";}
function startTask(){
  closeTask();
  openChat(currentChar); 
  alert("üéØ Nhi·ªám v·ª• b·∫Øt ƒë·∫ßu! Tr√≤ chuy·ªán v√† ho√†n th√†nh ƒë·ªÉ nh·∫≠n 10 üå∏.");
}

// ===== Phone Char (Doki Chat) =====
function updatePhoneChar(){
  document.getElementById("phoneChar").style.display="block";
  document.getElementById("phoneHeader").innerText=`ƒêi·ªán tho·∫°i ${currentChar}`;
  const content=document.getElementById("phoneContent");
  content.innerHTML="";

  // L·ªãch tr√¨nh
  let sched=document.createElement("div");
  sched.className="phone-section";
  sched.innerHTML="<h4>L·ªãch tr√¨nh</h4>"+charData[currentChar].schedule.map(t=>`<div>${t}</div>`).join("");
  content.appendChild(sched);

  // L·ªãch s·ª≠ t√¨m ki·∫øm
  let search=document.createElement("div");
  search.className="phone-section";
  search.innerHTML="<h4>L·ªãch s·ª≠ t√¨m ki·∫øm</h4>"+(charData[currentChar].searches.length?charData[currentChar].searches.map(s=>`<div>${s}</div>`).join(""):"<div>Tr·ªëng</div>");
  content.appendChild(search);

  // L·ªãch s·ª≠ chat
  let chatHist=document.createElement("div");
  chatHist
  // L·ªãch s·ª≠ chat
chatHist.className="phone-section";
chatHist.innerHTML="<h4>L·ªãch s·ª≠ chat</h4>";
if(charData[currentChar].messages.length){
  charData[currentChar].messages.forEach(m=>{
    let div=document.createElement("div");
    div.innerText=`${m.from==="player"?"B·∫°n":"Char"}: ${m.text}`;
    chatHist.appendChild(div);
  });
}else{
  chatHist.innerHTML+="<div>Tr·ªëng</div>";
}
content.appendChild(chatHist);
}

// ===== Kh·ªüi t·∫°o khi load =====
window.onload=function(){
  // N·∫øu ƒë√£ l∆∞u player tr∆∞·ªõc ƒë√≥
  if(localStorage.getItem("playerName")){
    player=localStorage.getItem("playerName");
    playerAge=localStorage.getItem("playerAge");
    const today=new Date().toISOString().slice(0,10);
    if(localStorage.getItem("lastClaim")!==today){
      document.getElementById("daily").style.display="flex";
    }else showCharList();
  }
};
</script>
</body>
</html>
